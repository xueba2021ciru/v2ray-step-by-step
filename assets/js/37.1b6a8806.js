(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{423:function(a,s,t){"use strict";t.r(s);var v=t(46),r=Object(v.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"android-免-root-运行-core"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#android-免-root-运行-core"}},[a._v("#")]),a._v(" Android 免 Root 运行 core")]),a._v(" "),t("p",[a._v("安卓无 Root 权限运行 V2Ray-core 并配置全局代理")]),a._v(" "),t("p",[a._v("此方法适用于不经常更改配置且设备无 Root 权限的用户")]),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("准备工具：")]),a._v(" "),t("ul",[t("li",[a._v("电脑")]),a._v(" "),t("li",[a._v("adb 环境")]),a._v(" "),t("li",[a._v("数据线(用于设备与电脑连接)")])]),a._v(" "),t("p",[a._v("必备技能：")]),a._v(" "),t("ul",[t("li",[a._v("了解 APN 设置")]),a._v(" "),t("li",[a._v("一些 Linux 实践经验")]),a._v(" "),t("li",[a._v("会"),t("a",{attrs:{href:"https://www.v2fly.org/developer/intro/compile.html#%E5%A4%9A%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[a._v("编译 V2Ray-core"),t("OutboundLink")],1)]),a._v(" "),t("li",[a._v("会设置你所用的操作系统的环境变量")])]),a._v(" "),t("p",[a._v("测试终端环境：")]),a._v(" "),t("ul",[t("li",[a._v("Android 10")]),a._v(" "),t("li",[a._v("ARM V8")])]),a._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),t("p",[a._v("由于 Golang 仅支持 Android 10+ 低版本 Android 可能无法通过此方法运行")])]),a._v(" "),t("p",[a._v("缺点：")]),a._v(" "),t("ul",[t("li",[a._v("设备重启后需要手动启动程序")]),a._v(" "),t("li",[a._v("USB 使用 "),t("code",[a._v("文件传输")]),a._v(" 模式时会自动结束所有通过此方法启动的进程")])]),a._v(" "),t("h2",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[a._v("#")]),a._v(" 准备")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("此现象在 v4.34+ 版本已经处理，可以直接进行"),t("a",{attrs:{href:"#%E7%BC%96%E8%AF%91"}},[a._v("编译")]),a._v("步骤")]),a._v(" "),t("p",[a._v("详情见"),t("a",{attrs:{href:"https://github.com/v2fly/v2ray-core/pull/572",target:"_blank",rel:"noopener noreferrer"}},[a._v("#572"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("若想自定义默认 DNS 仍然可以使用"),t("a",{attrs:{href:"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"}},[a._v("解决方法")]),a._v("中修改源码的方案")])]),a._v(" "),t("p",[a._v("由于 Android 系统中没有 "),t("code",[a._v("/etc/resolv.conf")]),a._v(" 加上没有 Root 权限也就无法创建，所以 Go 语言读取不到该文件就使用了默认设定的地址 "),t("code",[a._v("127.0.0.1:53")]),a._v(" (但 Android 并不存在 53 的本地 DNS)，又因为系统限制不能监听低位端口号也就无法使用\nV2Ray 来处理这个问题；因此直接运行 "),t("code",[a._v("core")]),a._v(" 会由于 Go 语言(Android)的影响导致 DNS 解析出现问题")]),a._v(" "),t("h3",{attrs:{id:"解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[a._v("#")]),a._v(" 解决方法")]),a._v(" "),t("p",[a._v("克隆代码后，"),t("a",{attrs:{href:"https://github.com/v2fly/v2ray-core/blob/master/infra/conf/dns_bootstrap_android.go#L10",target:"_blank",rel:"noopener noreferrer"}},[a._v("修改这里"),t("OutboundLink")],1),a._v("即可；例如修改为 "),t("code",[a._v("1.1.1.1")]),a._v(" DNS 则")]),a._v(" "),t("div",{staticClass:"language-go extra-class"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" bootstrapDNS "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.1.1.1:53"')]),a._v("\n")])])]),t("p",[a._v("仅支持传统 UDP DNS")]),a._v(" "),t("h2",{attrs:{id:"编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[a._v("#")]),a._v(" 编译")]),a._v(" "),t("p",[a._v("Go 语言主要通过 "),t("code",[a._v("GOOS")]),a._v(" 和 "),t("code",[a._v("GOARCH")]),a._v(" 来控制编译环境")]),a._v(" "),t("h3",{attrs:{id:"环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境变量"}},[a._v("#")]),a._v(" 环境变量")]),a._v(" "),t("p",[a._v("使用 "),t("code",[a._v("arm64")]),a._v(" 即为 ARM V8")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("SET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOOS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("android\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOARCH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("arm64\n")])])]),t("p",[a._v("其他 ARM 架构，列如 V7")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("SET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOOS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("android\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOARCH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("arm\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOARM")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("\n")])])]),t("p",[a._v("进入 "),t("code",[a._v("v2ray-core")]),a._v(" 目录，完整的命令如下(Windows)")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("SET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CGO_ENABLED")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOOS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("android\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GOARCH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("arm64\ngo build -o D:/v2ray -trimpath -ldflags "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-s -w -buildid="')]),a._v(" ./main\ngo build -o D:/v2ctl -trimpath -ldflags "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-s -w -buildid="')]),a._v(" -tags confonly ./infra/control/main\n")])])]),t("p",[a._v("编译的程序放在 "),t("code",[a._v("D:/")])]),a._v(" "),t("h2",{attrs:{id:"资源存放"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源存放"}},[a._v("#")]),a._v(" 资源存放")]),a._v(" "),t("p",[a._v("将 "),t("code",[a._v("v2ray")]),a._v(" 和 "),t("code",[a._v("v2ctl")]),a._v(" 以及配置文件等资源放入你设备的内部存储中")]),a._v(" "),t("p",[a._v('例如 "手机内部存储/V2Ray" 文件夹')]),a._v(" "),t("h2",{attrs:{id:"运行-v2ray"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行-v2ray"}},[a._v("#")]),a._v(" 运行 V2Ray")]),a._v(" "),t("h3",{attrs:{id:"连接-adb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接-adb"}},[a._v("#")]),a._v(" 连接 ADB")]),a._v(" "),t("ol",[t("li",[a._v("使用数据线连接电脑")]),a._v(" "),t("li",[a._v("打开设备的 USB 调试")]),a._v(" "),t("li",[a._v('开启 "仅充电" 模式下允许 ADB 调试')]),a._v(" "),t("li",[a._v('将 USB 连接模式改为 "文件传输"')])]),a._v(" "),t("h3",{attrs:{id:"检测设备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检测设备"}},[a._v("#")]),a._v(" 检测设备")]),a._v(" "),t("p",[a._v("打开终端输入并以下命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("adb devices\n")])])]),t("p",[a._v('若设备提示 "是否允许 USB 调试"，勾选 "始终允许..." 后确认')]),a._v(" "),t("p",[a._v("终端显示如下则表示为连接成功")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("List of devices attached\n1234567C06011253        device\n")])])]),t("h3",{attrs:{id:"传输文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#传输文件"}},[a._v("#")]),a._v(" 传输文件")]),a._v(" "),t("p",[a._v("继续输入以下命令，此时终端会变为手机的标识符")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("adb shell\n")])])]),t("p",[a._v("将设备内部存储中的 V2Ray 程序复制到设备临时目录中并给予权限")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cp /sdcard/V2Ray/* /data/local/tmp/\ncd /data/local/tmp/\nchmod 777 v2*\n")])])]),t("p",[a._v("尝试运行一下；由于系统限制建议 Inbound 内的入站使用 "),t("code",[a._v("1024")]),a._v(" 以上的端口号")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./v2ray\n")])])]),t("p",[a._v("测试无问题后按下 "),t("code",[a._v("Ctrl+C")]),a._v(' 结束进程，然后把 USB 传输模式改为 "仅充电"')]),a._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),t("p",[a._v('由于 Android 系统限制，"传输文件" 模式下无论怎样只要断开连接就会结束所有通过此方法运行的程序')])]),a._v(" "),t("p",[a._v("再次连接进入到 "),t("code",[a._v("/data/local/tmp")]),a._v(" 目录")]),a._v(" "),t("p",[a._v("后台运行 V2Ray")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" ./v2ray "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),t("p",[a._v("此时，打开任务管理器，找到名为 "),t("code",[a._v("adb")]),a._v(" 的进程然后结束它；Windows 如果有两个进程则结束第二个")]),a._v(" "),t("p",[a._v("这样就能解决 adb 断开连接后进程被结束的问题")]),a._v(" "),t("h2",{attrs:{id:"全局代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局代理"}},[a._v("#")]),a._v(" 全局代理")]),a._v(" "),t("p",[a._v("此处使用系统 APN 来完成，Inbound 需要一个 HTTP 入站代理")]),a._v(" "),t("p",[a._v("由于默认的 APN 不允许更改，所以需要新建一个 APN；内容复制默认的就可以")]),a._v(" "),t("p",[a._v('设置中 "代理" 一栏中填入 '),t("code",[a._v("127.0.0.1")]),a._v("，端口号为你 HTTP 入站的端口号，保存即可")]),a._v(" "),t("p",[a._v("返回上层设置，选择这个 APN 即可")]),a._v(" "),t("h3",{attrs:{id:"细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#细节"}},[a._v("#")]),a._v(" 细节")]),a._v(" "),t("p",[a._v("HTTP 代理只在 HTTP 场景下才会使用，理论上来讲并不会影响游戏对局，但这里并没有实验")]),a._v(" "),t("p",[a._v("使用 APN 的代理方式大多数的应用程序都会有效，但如 Telegram 这类特殊的应用程序无效")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("此类程序应用内设置中通常都会提供设置代理的选项，手动设置一下即可")])]),a._v(" "),t("p",[a._v("由于此方法更新资源不方便，建议选择可靠的 DNS 路由使用 "),t("code",[a._v("IPOnDemand")]),a._v(" 模式")]),a._v(" "),t("h2",{attrs:{id:"其他"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[a._v("#")]),a._v(" 其他")]),a._v(" "),t("p",[a._v("相比套壳 App，使用此方式启动的 "),t("code",[a._v("core")]),a._v(" 长时间运行并不会导致设备发热和明显的电量消耗")])])}),[],!1,null,null,null);s.default=r.exports}}]);