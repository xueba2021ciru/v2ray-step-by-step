<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mount the Tinc LAN node | V2Ray Beginner&#39;s Guide</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Step-by-step guide for first-timers' using V2Ray.">
    
    <link rel="preload" href="/assets/css/0.styles.acb9685a.css" as="style"><link rel="preload" href="/assets/js/app.319c1fa4.js" as="script"><link rel="preload" href="/assets/js/2.634a57e3.js" as="script"><link rel="preload" href="/assets/js/78.fa0aabf1.js" as="script"><link rel="prefetch" href="/assets/js/10.2ab7988b.js"><link rel="prefetch" href="/assets/js/100.312ef596.js"><link rel="prefetch" href="/assets/js/101.db1901ca.js"><link rel="prefetch" href="/assets/js/102.6cf06404.js"><link rel="prefetch" href="/assets/js/103.a8077f2e.js"><link rel="prefetch" href="/assets/js/104.3eb13793.js"><link rel="prefetch" href="/assets/js/11.93b9e3f2.js"><link rel="prefetch" href="/assets/js/12.c5af76dc.js"><link rel="prefetch" href="/assets/js/13.e5087840.js"><link rel="prefetch" href="/assets/js/14.33bceb5a.js"><link rel="prefetch" href="/assets/js/15.f12e1357.js"><link rel="prefetch" href="/assets/js/16.f383bc1b.js"><link rel="prefetch" href="/assets/js/17.851bc3bf.js"><link rel="prefetch" href="/assets/js/18.fbf174f8.js"><link rel="prefetch" href="/assets/js/19.defa8e1a.js"><link rel="prefetch" href="/assets/js/20.932b2db8.js"><link rel="prefetch" href="/assets/js/21.b1e45444.js"><link rel="prefetch" href="/assets/js/22.e85320e0.js"><link rel="prefetch" href="/assets/js/23.f7bd1711.js"><link rel="prefetch" href="/assets/js/24.7a7a05e6.js"><link rel="prefetch" href="/assets/js/25.1f4e0049.js"><link rel="prefetch" href="/assets/js/26.b5e8ba00.js"><link rel="prefetch" href="/assets/js/27.089cbd1d.js"><link rel="prefetch" href="/assets/js/28.760bbb28.js"><link rel="prefetch" href="/assets/js/29.878923db.js"><link rel="prefetch" href="/assets/js/3.21b3bd68.js"><link rel="prefetch" href="/assets/js/30.bbce839e.js"><link rel="prefetch" href="/assets/js/31.f2e57325.js"><link rel="prefetch" href="/assets/js/32.9d7aa670.js"><link rel="prefetch" href="/assets/js/33.fd7fc541.js"><link rel="prefetch" href="/assets/js/34.864aa825.js"><link rel="prefetch" href="/assets/js/35.2b725083.js"><link rel="prefetch" href="/assets/js/36.c4e976a3.js"><link rel="prefetch" href="/assets/js/37.1b6a8806.js"><link rel="prefetch" href="/assets/js/38.3974d4b0.js"><link rel="prefetch" href="/assets/js/39.e7d0b2e5.js"><link rel="prefetch" href="/assets/js/4.e4e11a9d.js"><link rel="prefetch" href="/assets/js/40.f921051f.js"><link rel="prefetch" href="/assets/js/41.19ce4c62.js"><link rel="prefetch" href="/assets/js/42.b508ec0b.js"><link rel="prefetch" href="/assets/js/43.29d8a45a.js"><link rel="prefetch" href="/assets/js/44.2dab3507.js"><link rel="prefetch" href="/assets/js/45.1279e686.js"><link rel="prefetch" href="/assets/js/46.f46ca079.js"><link rel="prefetch" href="/assets/js/47.b35e3f94.js"><link rel="prefetch" href="/assets/js/48.2272a13d.js"><link rel="prefetch" href="/assets/js/49.a9a5579d.js"><link rel="prefetch" href="/assets/js/5.e6bff27c.js"><link rel="prefetch" href="/assets/js/50.6c4f6a91.js"><link rel="prefetch" href="/assets/js/51.3c8e1bfb.js"><link rel="prefetch" href="/assets/js/52.6e8e45d1.js"><link rel="prefetch" href="/assets/js/53.98182984.js"><link rel="prefetch" href="/assets/js/54.7543d427.js"><link rel="prefetch" href="/assets/js/55.636316fb.js"><link rel="prefetch" href="/assets/js/56.868924aa.js"><link rel="prefetch" href="/assets/js/57.4ffb71e0.js"><link rel="prefetch" href="/assets/js/58.75502ef8.js"><link rel="prefetch" href="/assets/js/59.4a39708f.js"><link rel="prefetch" href="/assets/js/6.7d390845.js"><link rel="prefetch" href="/assets/js/60.1f8dd688.js"><link rel="prefetch" href="/assets/js/61.68cec899.js"><link rel="prefetch" href="/assets/js/62.d99a96a0.js"><link rel="prefetch" href="/assets/js/63.b70f527d.js"><link rel="prefetch" href="/assets/js/64.ae2eaf92.js"><link rel="prefetch" href="/assets/js/65.aa8b1323.js"><link rel="prefetch" href="/assets/js/66.f586f6fc.js"><link rel="prefetch" href="/assets/js/67.73c99724.js"><link rel="prefetch" href="/assets/js/68.1154a822.js"><link rel="prefetch" href="/assets/js/69.0d59b8b7.js"><link rel="prefetch" href="/assets/js/7.290967ec.js"><link rel="prefetch" href="/assets/js/70.7df3f334.js"><link rel="prefetch" href="/assets/js/71.d2a5a2b6.js"><link rel="prefetch" href="/assets/js/72.7d60cac1.js"><link rel="prefetch" href="/assets/js/73.3cdaa253.js"><link rel="prefetch" href="/assets/js/74.18784001.js"><link rel="prefetch" href="/assets/js/75.e97d24dd.js"><link rel="prefetch" href="/assets/js/76.14c510d8.js"><link rel="prefetch" href="/assets/js/77.7bf7ff01.js"><link rel="prefetch" href="/assets/js/79.3b9f75d7.js"><link rel="prefetch" href="/assets/js/8.3afc79f6.js"><link rel="prefetch" href="/assets/js/80.8b7b4b8b.js"><link rel="prefetch" href="/assets/js/81.2a548eac.js"><link rel="prefetch" href="/assets/js/82.698b4345.js"><link rel="prefetch" href="/assets/js/83.6c7a3f68.js"><link rel="prefetch" href="/assets/js/84.c55e0760.js"><link rel="prefetch" href="/assets/js/85.9b2f67ab.js"><link rel="prefetch" href="/assets/js/86.49f5303e.js"><link rel="prefetch" href="/assets/js/87.a98dc301.js"><link rel="prefetch" href="/assets/js/88.a3b242f9.js"><link rel="prefetch" href="/assets/js/89.20668025.js"><link rel="prefetch" href="/assets/js/9.4d60c8eb.js"><link rel="prefetch" href="/assets/js/90.0c459eff.js"><link rel="prefetch" href="/assets/js/91.dd87256b.js"><link rel="prefetch" href="/assets/js/92.7c6f0dbd.js"><link rel="prefetch" href="/assets/js/93.cba8172b.js"><link rel="prefetch" href="/assets/js/94.f84108c5.js"><link rel="prefetch" href="/assets/js/95.cd18b8a5.js"><link rel="prefetch" href="/assets/js/96.dad6f691.js"><link rel="prefetch" href="/assets/js/97.5f3874ec.js"><link rel="prefetch" href="/assets/js/98.fc39fc1b.js"><link rel="prefetch" href="/assets/js/99.44a17d29.js">
    <link rel="stylesheet" href="/assets/css/0.styles.acb9685a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en_US/" class="home-link router-link-active"><!----> <span class="site-name">V2Ray Beginner's Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://v2fly.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/app/tinc_proxy.html" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en_US/app/tinc_proxy.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/v2fly/v2ray-step-by-step" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://v2fly.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/app/tinc_proxy.html" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en_US/app/tinc_proxy.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/v2fly/v2ray-step-by-step" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Preface</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/" aria-current="page" class="sidebar-link">Guide to V2Ray configuration</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/prep/prep" class="sidebar-heading clickable"><span>Before start</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/basics/basics" class="sidebar-heading clickable"><span>Basics</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/advanced/advanced" class="sidebar-heading clickable"><span>Advanced</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/app/app" class="sidebar-heading clickable open"><span>Practical</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/app/transparent_proxy.html" class="sidebar-link">Transparent Proxy</a></li><li><a href="/en_US/app/reverse.html" class="sidebar-link">Reverse Proxy I</a></li><li><a href="/en_US/app/reverse2.html" class="sidebar-link">Reverse Proxy II</a></li><li><a href="/en_US/app/parent.html" class="sidebar-link">Forward Proxy</a></li><li><a href="/en_US/app/balance.html" class="sidebar-link">Load Balancing</a></li><li><a href="/en_US/app/docker-deploy-v2ray.html" class="sidebar-link">Deploying V2Ray by Docker</a></li><li><a href="/en_US/app/benchmark.html" class="sidebar-link">Benchmark</a></li><li><a href="/en_US/app/optimization.html" class="sidebar-link">Memory optimization</a></li><li><a href="/en_US/app/tinc_proxy.html" aria-current="page" class="active sidebar-link">Mount the Tinc LAN node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#tinc-installation" class="sidebar-link">Tinc installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#tinc-compile-and-install" class="sidebar-link">Tinc compile and install</a></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#systemd-service-file-modification" class="sidebar-link">systemd service file modification</a></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#finishing-work" class="sidebar-link">Finishing work</a></li></ul></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#build-a-tinc-node" class="sidebar-link">Build a tinc node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#construction-of-the-main-node" class="sidebar-link">Construction of the main node</a></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#construction-of-load-point" class="sidebar-link">Construction of load point</a></li></ul></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#load-node-v2ray-construction-10-0-0-2-n" class="sidebar-link">Load node V2Ray construction (10.0.0.2~n)</a></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#master-node-reverse-proxy-10-0-0-1" class="sidebar-link">Master node reverse proxy (10.0.0.1)</a></li><li class="sidebar-sub-header"><a href="/en_US/app/tinc_proxy.html#common-problem" class="sidebar-link">common problem</a></li></ul></li><li><a href="/en_US/app/android_without_root_use_v2ray.html" class="sidebar-link">Android Root-free running core</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/routing/routing" class="sidebar-heading clickable"><span>Routing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mount-the-tinc-lan-node"><a href="#mount-the-tinc-lan-node" class="header-anchor">#</a> Mount the Tinc LAN node</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This configuration example is based on CentOS 8, please modify as appropriate.</p></div> <p>Nowadays, Cloudflare's CDN is widely used to prevent GFW from blocking IP, but at present Cloudflare has long been overwhelmed with traffic forwarding for this purpose, especially the frequent occurrence of CDN node explosion problems at night, providing a new way to alleviate Cloudflare's perennial night The problem of slowness.</p> <p>This way of constructing the V2Ray solution is to use the intranet penetration software to use all the VPSs in your hands as network nodes to select the IP that is not shielded by the GFW as the master node, and all V2Ray data request the master node to be diverted to Other VPS: When the GFW blocks the IP of the master node, let other nodes rise to the master node, and the original master node drops to the load node.</p> <blockquote><p>This mode is similar to the <code>Follwer/Leader</code> mode. <code>Leader</code> selects the best VPS to proxy all V2ray traffic and forward it to <code>Follwer</code>.</p></blockquote> <p>Please note: The ideas and methods provided in this tutorial must have at least a certain level of operating ability for the Linux system. If you don't have a clear understanding, please don't mess around!</p> <p>The program requirements here have the following requirements:</p> <ul><li>At least two servers</li> <li>Nginx-based upstream</li> <li>Tinc-based intranet penetration node function</li></ul> <p>The main configuration purpose here:
If the server IP is blocked, another server will be used directly to participate in node forwarding. Generally, GFW will block the IP for a time limit, and it will continue to use the original IP in rotation after the blocking period such as through the node forwarding.</p> <h2 id="tinc-installation"><a href="#tinc-installation" class="header-anchor">#</a> Tinc installation</h2> <p>The kernel's <code>ip_foward</code> function must be enabled before the configuration starts. If it is not enabled, please manually enable forwarding.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> sysctl -a<span class="token operator">|</span><span class="token function">grep</span> ip_forward <span class="token comment"># Check whether ip_forward forwarding is enabled [net.ipv4.ip_forward=1]</span>
</code></pre></div><p>The reason why Tinc is used as the penetration software in this example is because it is simple enough and dependent on the performance of C language programs, and Tinc's IPv6 support is not bad, and the configuration is relatively simple and not that complicated. Other frp, ngrok, etc. can be customized Get used to choosing.</p> <p>Some distribution sources have built-in Tinc, but this article uses compile and install to deploy Tinc.
The download address of the latest version of Tinc can be found on <a href="https://www.tinc-vpn.org/" target="_blank" rel="noopener noreferrer">Official Website<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <h3 id="tinc-compile-and-install"><a href="#tinc-compile-and-install" class="header-anchor">#</a> Tinc compile and install</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> /tmp <span class="token comment"># My usual practice is to download and compile in the /tmp directory to prevent downloading and compilation from being scattered in other directories</span>
$ <span class="token function">wget</span> https://www.tinc-vpn.org/packages/tinc-1.0.36.tar.gz -O tinc.tar.gz <span class="token comment"># Download and get the latest version of the source code package</span>
$ <span class="token function">tar</span> -xf tinc.tar.gz --one-top-level --strip-components<span class="token operator">=</span><span class="token number">1</span> <span class="token comment"># Unzip the compressed package</span>
$ <span class="token builtin class-name">cd</span> tinc <span class="token comment"># enter the folder</span>
</code></pre></div><p>Before starting the compilation work, you need to install the corresponding dependent libraries:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> dnf <span class="token function">install</span> gcc cmake <span class="token function">make</span> openssl-devel zlib-devel lzo-devel <span class="token comment"># CentOS installation, other distributions can be searched and installed by name</span>
</code></pre></div><p>After confirming the installation of the dependent library, start compiling and installing:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./configure
$ <span class="token function">make</span>
$ <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span> <span class="token comment"># Root permission is needed to install here</span>
$ tincd --version <span class="token comment"># Test and print the version number after installation</span>
</code></pre></div><h3 id="systemd-service-file-modification"><a href="#systemd-service-file-modification" class="header-anchor">#</a> systemd service file modification</h3> <p>The compressed package downloaded here comes with two system services, which can actually be modified:</p> <ul><li>/tmp/tinc/systemd/tinc.service.in</li> <li>/tmp/tinc/systemd/tinc@.service.in</li></ul> <p><code>tinc.service.in</code> file configuration:</p> <p>Content modification:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># Shield `WorkingDirectory=@sysconfdir@/tinc`</span>
<span class="token comment"># Add the following content</span>
<span class="token key attr-name">WorkingDirectory</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/etc/tinc</span>
</code></pre></div><p>Copy to the systemd folder:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">cp</span> /tmp/tinc/systemd/tinc.service.in /lib/systemd/system/tinc.service <span class="token comment"># Copy to the system service folder</span>
$ <span class="token function">sudo</span> <span class="token function">vi</span> /lib/systemd/system/tinc.service <span class="token comment"># Modify content</span>
</code></pre></div><p><code>tinc@.service.in</code> file configuration:</p> <p>Content modification:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># Block the following</span>
<span class="token comment"># WorkingDirectory=@sysconfdir@/tinc/%i</span>
<span class="token comment"># ExecStart=@sbindir@/tincd -n %i -D</span>
<span class="token comment"># ExecReload=@sbindir@/tincd -n %i -kHUP</span>
<span class="token comment"># Add the following content</span>
<span class="token key attr-name">WorkingDirectory</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/etc/tinc/%i</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/sbin/tincd -n %i -D</span>
<span class="token key attr-name">ExecReload</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/sbin/tincd -n %i -kHUP</span>
</code></pre></div><p>Copy to the systemd folder:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">cp</span> /tmp/tinc/systemd/tinc@.service.in /lib/systemd/system/tinc@.service <span class="token comment"># Copy to the system service folder</span>
$ <span class="token function">sudo</span> <span class="token function">vi</span> /lib/systemd/system/tinc@.service <span class="token comment"># Modify content</span>
</code></pre></div><h3 id="finishing-work"><a href="#finishing-work" class="header-anchor">#</a> Finishing work</h3> <p>After completing the configuration copy and modification, prepare the final system configuration loading process without any problems</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/var/run/ <span class="token comment"># Create and run PID directory</span>
$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p /usr/local/etc/tinc <span class="token comment"># Create a configuration directory for service configuration loading</span>
$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/local/etc/tinc /etc/tinc <span class="token comment"># Set the soft link of the /etc configuration file</span>
$ <span class="token function">sudo</span> systemctl unmask tinc <span class="token comment"># refresh the Systemctl system service just loaded</span>
</code></pre></div><h2 id="build-a-tinc-node"><a href="#build-a-tinc-node" class="header-anchor">#</a> Build a tinc node</h2> <p>It should be stated here that the following specifications need to be clarified:</p> <ul><li>10.0.0.1 is the main node that mainly accepts client V2ray data</li> <li>10.0.0.2~n are the load nodes forwarded by the agent</li> <li>The master node uses Nginx to forward data traffic to 10.0.0.2~n to other servers</li> <li>All nodes need to install Tinc and Nginx</li></ul> <h3 id="construction-of-the-main-node"><a href="#construction-of-the-main-node" class="header-anchor">#</a> Construction of the main node</h3> <p>Build information for creating a node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> /etc/tinc <span class="token comment"># Enter the configuration directory</span>
$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/tinc/v2ray/hosts <span class="token comment"># Create a V2ray penetration node and set it to allow access to the host configuration directory</span>
</code></pre></div><p>Edit the configuration file (/etc/tinc/v2ray/tinc.conf):</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment">## Here Name is the name of the configuration file. I generally like to name this file node `master-slave`/`node_01-node_02`</span>
<span class="token comment">## The default port monitors 665, here is set 20665, generally I don't like to use the default port directly, it is easy to be scanned out of the corresponding service by the robot</span>
<span class="token comment">## Here routing mode uses switch mode [Switch ], other modes can refer to the official website configuration</span>
<span class="token key attr-name">Name</span> <span class="token punctuation">=</span> <span class="token value attr-value">master</span>
<span class="token key attr-name">Interface</span> <span class="token punctuation">=</span> <span class="token value attr-value">v2ray</span>
<span class="token key attr-name">Port</span><span class="token punctuation">=</span><span class="token value attr-value">20065</span>
<span class="token key attr-name">Mode</span><span class="token punctuation">=</span><span class="token value attr-value">switch</span>
</code></pre></div><p>Write the details of the master node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/tinc/v2ray/hosts/master
</code></pre></div><p>Main node link information content:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment">## Here Address represents own address IP and port opening information</span>
<span class="token comment">## If the server IP is Ban, you need to switch the master node to the load node and remember to change the IP to the master node IP</span>
<span class="token comment">## Subnet represents the address of the intranet penetration node</span>
<span class="token key attr-name">Address</span> <span class="token punctuation">=</span> <span class="token value attr-value">VPS own IP 20665</span>
<span class="token key attr-name">Subnet</span> <span class="token punctuation">=</span> <span class="token value attr-value">10.0.0.1/32</span>
</code></pre></div><p>After completion, you need to generate the connection key, and he will attach the key information at the end of the master file</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The general format here is tincd -n node name -K [2048/4096, the encryption level is not recommended too high, V2Ray itself is with encrypted unnecessary data and then too complex encryption]</p></div> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> /usr/local/sbin/tincd -n v2ray -K <span class="token number">2048</span>
</code></pre></div><p>Write a script to start the virtual switch (/etc/tinc/v2ray/tinc-up), the content is as follows:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 10.0.0.1 represents the node address occupied by the node, which must be unique</span>
<span class="token function">ifconfig</span> <span class="token variable">$INTERFACE</span> <span class="token number">10.0</span>.0.1 netmask <span class="token number">255.255</span>.255.0
</code></pre></div><p>Write the error shutdown script (/etc/tinc/v2ray/tinc-down) as follows:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token function">ifconfig</span> <span class="token variable">$INTERFACE</span> down
</code></pre></div><p>Finish the work, and finally grant script execution permissions and manually open ports/services:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/tinc/v2ray/tinc-* <span class="token comment"># Grant script startup permission,</span>
$ <span class="token function">sudo</span> systemctl start tinc@v2ray <span class="token comment"># start system service</span>
$ <span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">20665</span>/tcp --permanent <span class="token comment"># If there is a firewall, remember to open the external port</span>
$ <span class="token function">sudo</span> firewall-cmd --reload <span class="token comment"># Update firewall configuration</span>
$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> tinc@v2ray <span class="token comment"># Automatically start the service at boot, this is actually recommended to debug and then enable</span>
</code></pre></div><h3 id="construction-of-load-point"><a href="#construction-of-load-point" class="header-anchor">#</a> Construction of load point</h3> <p>The installation and configuration method is basically the same as that of the master node. Here, the process is roughly summarized below, and only the key configuration nodes are noted.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/tinc/v2ray/hosts <span class="token comment"># Confirm the configuration file directory consistent with the master node</span>
</code></pre></div><p>The configuration node information (/etc/tinc/v2ray/tinc.conf) is slightly different here, please refer to the following example:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># Name represents the configuration file name of the load node [hosts/slave_01], this file will be placed in the hosts directory of the master node later</span>
<span class="token comment"># ConnectTo represents the intranet node configuration file [hosts/master] through which the access is penetrated. This file is the configuration file that copies the hosts of the master node</span>
<span class="token comment"># Points to know here:</span>
<span class="token comment"># * Name cannot conflict with other nodes</span>
<span class="token comment"># * ConnectTo must be a configuration file with a key attached to the master node</span>
<span class="token comment"># * Interface/Mode must be consistent with the master node configuration</span>
<span class="token key attr-name">Name</span> <span class="token punctuation">=</span> <span class="token value attr-value">slave_01</span>
<span class="token key attr-name">Interface</span> <span class="token punctuation">=</span> <span class="token value attr-value">v2ray</span>
<span class="token key attr-name">ConnectTo</span> <span class="token punctuation">=</span> <span class="token value attr-value">master</span>
<span class="token key attr-name">Mode</span><span class="token punctuation">=</span><span class="token value attr-value">switch</span>
</code></pre></div><p>Configure the link (/etc/tinc/v2ray/hosts/slave_01), the content is as follows:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># Note that this must correspond to 10.0.0.2～255 of the server</span>
<span class="token comment"># This is the intranet IP of the node</span>
<span class="token key attr-name">Subnet</span> <span class="token punctuation">=</span> <span class="token value attr-value">10.0.0.2/32</span>
</code></pre></div><p>Generate key information after the final configuration:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> /usr/local/sbin/tincd -n v2ray -K
</code></pre></div><p>The content of the startup script of the load node is different [/etc/tinc/v2ray/tinc-up]</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># The IP address here is changed to the address selected by the node</span>
<span class="token function">ifconfig</span> <span class="token variable">$INTERFACE</span> <span class="token number">10.0</span>.0.2 netmask <span class="token number">255.255</span>.255.0
</code></pre></div><p>When starting, please remember to copy the hosts file under the master node/load node to their respective directories to ensure that the hosts directories of both parties have the following corresponding contents:</p> <div class="language-plain extra-class"><pre class="language-plain"><code>$ ls -l /etc/v2ray/hosts
  master [master node file]
  slave_01 [load node 01]
  slave_02 [load node 02]
  ...
</code></pre></div><p>Here, the load node does not need to open any ports, all connection information is recorded in the master node information (public network IP and port information).
But you need to manually configure the firewall, and all load nodes are allowed to pass the internal 10.0.0.1 (mentioned in the following chapter).</p> <p>Tinc does not have a log file function. Here is a recommended way to debug the connection, use SSH connection to test whether it is connected:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ssh</span> root@10.0.0.1 <span class="token comment"># The load node tests whether ssh can access the master node through the suspended 10.0.0.1</span>
</code></pre></div><h2 id="load-node-v2ray-construction-10-0-0-2-n"><a href="#load-node-v2ray-construction-10-0-0-2-n" class="header-anchor">#</a> Load node V2Ray construction (10.0.0.2~n)</h2> <p>The V2Ray installed here directly refers to other configurations, just need to explain that it is not recommended to use any forwarding/masquerading protocol for processing;
Directly use TCP to forward data, because Tinc itself has a data security encryption function, if you choose other V2ray other camouflage protocols, the performance will be greatly reduced.
All load nodes need to install V2Ray, and the configuration file is basically the same:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/v2ray/access.log&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/v2ray/error.log&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;loglevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span><span class="token comment">//Start a V2ray port randomly here, and directly follow the load node request 10.0.0.2:10000/10.0.0.3:10000</span>
        <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span><span class="token comment">//Open the public network here, remember that firewall-cmd I generally use firewal-cmd to manage the port, here there is no way to access it through the public network.</span>
        <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vmess&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;clients&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;alterId&quot;</span><span class="token operator">:</span> <span class="token number">64</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>After starting V2Ray, you need to release the 10.0.0.x address in a targeted manner. Remember to change the port to the V2Ray server port information under the load node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">&quot;rule family=&quot;</span>ipv4<span class="token string">&quot; source address=&quot;</span><span class="token number">10.0</span>.0.1<span class="token string">&quot; port protocol=&quot;</span>tcp<span class="token string">&quot; port=&quot;</span><span class="token punctuation">[</span>V2Ray's server port<span class="token punctuation">]</span><span class="token string">&quot; accept&quot;</span>
</code></pre></div><p>In this way, the load node of V2Ray is also configured.</p> <h2 id="master-node-reverse-proxy-10-0-0-1"><a href="#master-node-reverse-proxy-10-0-0-1" class="header-anchor">#</a> Master node reverse proxy (10.0.0.1)</h2> <p>I use Nginx upstream to reverse proxy traffic to other load nodes (/etc/nginx/nginx.conf), the configuration is as follows:</p> <div class="language-plain extra-class"><pre class="language-plain"><code>events {
    # This system will automatically select it, optional
    use epoll;
    # This sees the maximum connection configured by the machine [sudo ulimit -n # command to view the maximum]
    worker_connections 65535;
}

//Mainly add configuration option
stream{
  include /etc/nginx/stream.d/*.conf;
}

http{
  //........
}
</code></pre></div><p>Write the Nginx reverse proxy configuration (/etc/nginx/stream.d/v2ray.conf ), the content is as follows:</p> <div class="language-plain extra-class"><pre class="language-plain"><code>upstream v2ray {

  hash $remote_addr consistent;
  server 10.0.0.2:10000 weight=5;
  server 10.0.0.3:10000 weight=5;
  server 10.0.0.4:10000 weight=5;
  //.......
  //The master node continuously forwards the corresponding intranet penetration node according to the average weight
}

# Suspend TCP reverse proxy service
server {
  # Set up external access to V2ray port
  # v2ray's clients all request the master node: port 6666, which is then forwarded to the designated intranet node by the node's intranet penetration
  listen 6666;

  # Here directly forward to the data configuration configured above
  proxy_pass v2ray;
}
</code></pre></div><p>After completion, start the master node and connect to V2ray to check whether the data can be forwarded correctly.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If there is a firewall, please remember to open the port corresponding to Nginx for access.</p></div> <h2 id="common-problem"><a href="#common-problem" class="header-anchor">#</a> common problem</h2> <p>Q: If the IP of the master node is blocked, how to convert the load node to the master node?
A: Copy the /etc/tinc/v2ray directory of the master node directly to the available load node (remember to backup), change the public network IP of all nodes /etc/tinc/vpn/hosts/master files to the new node IP, copy Nginx can start the configuration, and open the Tinc or Nginx port at the same time.</p> <p>Q: Can I participate in the node through a Chinese server?
A: In the current test, if Chinese server nodes participate in load forwarding, there will be frequent timeouts and stalls. The efficiency is not as good as direct connection to overseas servers, but the speed is faster than WSS+CDN, and the stability is poor.</p> <p>Q: Can I use a more advanced masquerading protocol instead of TCP?
A: It can be used but not recommended. Tinc itself is an attached secure data encryption function. A large number of encryption shell processes will cause a sharp drop in performance.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en_US/app/optimization.html" class="prev">
        Memory optimization
      </a></span> <span class="next"><a href="/en_US/app/android_without_root_use_v2ray.html">
        Android Root-free running core
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.319c1fa4.js" defer></script><script src="/assets/js/2.634a57e3.js" defer></script><script src="/assets/js/78.fa0aabf1.js" defer></script>
  </body>
</html>
